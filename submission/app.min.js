e=document.createElement("div");e.innerHTML='<input style="position:fixed;z-index:9;top:0;width:99%;" placeholder="paste here">';b.appendChild(e);
e.querySelector("input").onchange=function(d){try{j=JSON.parse(d.target.value);p=Math.PI/180;o=[a.width*j.orig.x,a.height*j.orig.y];r=q();z=t();k=v(j.start,r,j.n);h=z(k);c.save();c.clearRect(0,0,a.width,a.height);a:{d=h;var f=j.step,n=o,A=j.dir*p;c.translate(n[0],n[1]);c.beginPath();c.rotate(A);i=0;for(l=d.length;i<l;i++){if(12E4<i){c.stroke();break a}g=d[i];c.rotate(g.a);g.b&&(m=g.d?"lineTo":"moveTo",c[m](f,0),c.translate(f,0))}c.stroke()}c.restore()}catch(B){}};
function v(d,f,n){if(!n)return d;y=d.split("").map(function(d){return f[d]?f[d]:d}).join("");return v(y,f,n-1)}function q(){return j.rules.reduce(function(d,f){x=f.split("=");d[x[0]]=x[1];return d},{})}function t(){var d=j.angle*p;u=-1*d;return function(f){w={"+":{a:d,b:0,d:0},"-":{a:u,b:0,d:0},F:{a:0,b:1,d:1},G:{a:0,b:1,d:1},M:{a:0,b:1,d:0}};return f.split("").map(function(d){return w[d]?w[d]:d})}}
